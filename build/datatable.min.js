/*! datatable 2014-05-28 */
angular.module("ui.datatable",[]).controller("tableController",["$scope",function(a){a.columns=[],a.sorter=[],a.current_page=1,a.no_of_pages=0,a.showEditColumn=!1,getSortName=function(a,b){return"asc"==b?a:"desc"==b?"-"+a:a},a.setCurrentPage=function(b){b>0&&b<=a.no_of_pages&&(a.current_page=b)},a.nextPage=function(){a.current_page<a.no_of_pages&&a.current_page++},a.prevPage=function(){a.current_page>1&&a.current_page--},a.sortStatus=function(b){if(a.options.hasOwnProperty("sortable")&&-1!=a.options.sortable.columns.indexOf(b)){var c="sortable";return angular.forEach(a.sorter,function(a){a==getSortName(b,"asc")&&(c="asc"),a==getSortName(b,"desc")&&(c="desc")}),c}return null},a.sort=function(b){if(-1!=a.options.sortable.columns.indexOf(b)){var c=a.sortStatus(b);c="sortable"==c?null:c,null!==c&&(index=a.sorter.indexOf(getSortName(b,c)),a.sorter.splice(index,1)),c&&(c="asc"==c?"desc":"asc"),a.sorter.unshift(getSortName(b,c))}},a.getColumns=function(){a.columns=[],a.options.hasOwnProperty("columns")&&(a.columns=angular.copy(a.options.columns)),angular.forEach(a.tableData,function(b){angular.forEach(b,function(b,c){-1==a.columns.indexOf(c)&&(!a.options.hasOwnProperty("columns")||a.options.hasOwnProperty("columns")&&-1!=a.options.columns.indexOf(c))&&a.columns.push(c)})})},a.setupSorter=function(){a.options.hasOwnProperty("sortable")&&a.options.sortable.hasOwnProperty("default")&&(a.sorter=angular.copy(a.options.sortable.default))},a.edit=function(b){a.options.hasOwnProperty("edit")&&a.options.edit.enable&&a.options.edit.onEdit(b)},a.delete=function(b){a.options.hasOwnProperty("delete")&&a.options.delete.enable&&a.options.delete.onDelete(b)},a.enableSearch=function(){return a.options.hasOwnProperty("search")&&a.options.search.enable?!0:!1},a.showPagination=function(){return a.no_of_pages>1?!0:!1},a.mouseOver=function(b){(a.options.edit.enable||a.options.delete.enable)&&(b.edit=!0,a.showEditColumn=!0)},a.mouseLeave=function(b){b.edit=!1,a.showEditColumn=!1},a.$watch("search",function(b,c){b!==c&&(a.current_page=1)})}]).filter("displayName",function(){return function(a,b){return b.options.hasOwnProperty("colDefs")&&b.options.colDefs.hasOwnProperty(a)&&b.options.colDefs[a].displayName?b.options.colDefs[a].displayName:a}}).filter("applyColumnFilter",function(a){return function(b,c,d){if(d.options.hasOwnProperty("colDefs")&&d.options.colDefs[c]){var e=d.options.colDefs[c],f=e.filter;if(f){var g=[b];return g=g.concat(f.args),a(f.name).apply(null,g)}}return b}}).filter("applyRowFilter",function(a){return function(b,c){if(c.options.hasOwnProperty("filter")){var d=c.options.filter;if(d){var e=[b];return e=e.concat(d.args),a(d.name).apply(this,e)}}return b}}).filter("search",function(a){return function(b,c,d){return d.options&&d.options.hasOwnProperty("search")&&d.options.search.enable&&c?(columns=d.options.search.columns,columns?b=a("filter")(b,function(a){var b=!1;for(var d in a)if(a[d]&&-1!=columns.indexOf(d)){var e=String(a[d]).toLowerCase();e.indexOf(c)>-1&&(b=!0)}return b}):a("filter")(b,c)):b}}).filter("range",function(){return function(a,b){b=parseInt(b);for(var c=0;b>c;c++)a.push(c+1);return a}}).filter("paginator",function(a){return function(b,c){var d=c.options.hasOwnProperty("limit")&&null!=c.options.limit?c.options.limit:50;c.no_of_pages=Math.ceil(b.length/d),c.no_of_elements_per_page=d;var e=(c.current_page-1)*c.no_of_elements_per_page;return b=a("limitTo")(b.slice(e),c.no_of_elements_per_page)}}).directive("mgTable",function(){return{scope:{tableData:"=mgData",options:"=mgDataOptions"},controller:"tableController",restrict:"E",templateUrl:"datatable.html",replace:!0,link:function(a,b,c){a.getColumns(),a.setupSorter(),c.$observe("mgDataOptions",function(){a.getColumns(),a.setupSorter()})}}}),angular.module("ui.datatable").run(["$templateCache",function(a){"use strict";a.put("datatable.html",'<div>\n	<div class="col-md-3 pull-right input-group" ng-show="enableSearch()">\n        <span class="input-group-addon">\n          <span class="glyphicon glyphicon-search"></span>\n        </span>\n        <input type="text" placeholder="search" class="form-control" ng-model="search">\n     </div>\n	<table class="table table-hover">\n		<thead>\n			<th ng-repeat="column in columns" ng-click="sort(column)">\n				<div class="sort-icon">\n					<span class="glyphicon glyphicon-chevron-up" ng-show="sortStatus(column) == \'asc\' || sortStatus(column) == \'sortable\'"></span>\n					<span class="glyphicon glyphicon-chevron-down" ng-show="sortStatus(column) == \'desc\' || sortStatus(column) == \'sortable\'"></span>\n				</div>\n				<span>{{ column | displayName:this }}</span>\n			</th>\n			<th class="edit-header">\n			</th>\n		</thead>\n		<tbody>\n			<tr ng-repeat="row in tableData | applyRowFilter: this | orderBy: sorter | search: search: this | paginator: this" ng-mouseover="mouseOver(row)" ng-mouseleave="mouseLeave(row)">\n				<td ng-repeat="column in columns">\n					{{ row[column] | applyColumnFilter: column: this }}\n				</td>\n				<td class="edit-body"ng-show="row.edit">\n					<div>\n						<button class="btn btn-default btn-sm" ng-show="options.edit.enable" ng-click="edit(row)"><span class="glyphicon glyphicon-edit"></span></button>\n						<button class="btn btn-default btn-sm" ng-show="options.delete.enable" ng-click="delete(row)"><span class="glyphicon glyphicon-trash"></span></button>\n					</div>\n				</td>\n				<td ng-hide="row.edit">\n					\n				</td>\n			</tr>\n		</tbody>\n	</table>\n	<ul class="pagination" ng-show="showPagination()">\n	  <li ng-class="{disabled: current_page == 1}"><a href="" ng-click="prevPage()" >&laquo;</a></li>\n	  <li ng-repeat="n in [] | range: no_of_pages" ng-class="{active: n==current_page}"><a href="" ng-click="setCurrentPage(n)" >{{n}}  <span class="sr-only">(current)</span></a></li>\n	  <li ng-class="{disabled: current_page == no_of_pages}"><a href="" ng-click="nextPage()" >&raquo;</a></li>\n	</ul>\n</div>')}]);